# XTF Surveyor: просмотр и преобразование XTF файлов

![XTF Surveyor screenshot](screenshot.png)

**Возможности программы:**

* просмотр файлов в формате XTF (eXtended Triton Format)
* сохранение выбранных каналов в SEG-Y файл или в (другой) XTF файл
* запись заголовкой трасс в табличный `.csv` файл

## Установка

Запустите файл с установщиком (`XTF_Surveyor-<версия>.msi`), следуйте инструкциям. Перед установкой убедитесь, что предыдущие версии программы удалены (Пуск -> Панель управления -> Установка и удаление программ).

## Работа с программой

* Запустите программу из меню *Пуск -> Программы -> XTF Surveyor*.
* Импортируйте `.xtf` файлы: *Profile -> Import XTF files...*
* Сохраните проект: *File -> Save Project...* Удобно, если `.xtf` файлы будут в одном из подкаталогов каталога, в котором находится проектный файл. В этом случае (если сохранить относительные пути) файлы будут открываться при переносе в другой каталог или  другой компьютер.
* Выберите канал и преобразуйте текущий файл в формат SEG-Y: кнопка *"Save to SEG-Y..."*. Для преобразования всех файлов проекта нажмите кнопку *"Save all to SEG-Y..."*. Преобразование в SEG-Y работает только если выбран ровно один канал.

*Замечание 1:* Не рекомендуется в одном проекте смешивать файлы с различающимися номерами каналов. Могут возникнуть проблемы при пакетном преобразовании файлов. В версии 0.6.1 была исправлена связанная с этим ошибка (подробности ниже).

*Замечание 2:* Программа XTF Surveyor работает некорректно, если в пути к файлам есть не-ASCII символы. Например, русские буквы.

## Поддерживаемый формат файлов

Программа обрабатывает сейсмоакустические данные в файлах eXtended Triton Format. Поддерживаются 8-битный и 16-битный  форматы данных трасс (поле `BytesPerSample`, раздел 3.2.2 [описания формата XTF][xtf]).

[xtf]: http://www.tritonimaginginc.com/site/content/public/downloads/FileFormatInfo/Xtf%20File%20Format_X35.pdf

## Параметры записи координат SEG-Y файлов

В XTF Surveyor **версии 0.5+** в SEG-Y файл записываются **прямоугольные координаты**, при этом в заголовках трасс указано (подробности [в стандарте SEG-Y][1], страница 14):

* Байты 71-72, коэффициент масштабирования: `1`.
* Байты 89-90, единицы измерения для координат: `1`, прямоугольные (метры).

При преобразовании в прямоугольные координаты применяется проекция UTM, Universal Transverse Mercator Projection (универсальная поперечная проекция Меркатора). Предполагается, что в XTF файлах координаты приведены на эллипсоиде WGS84.

По умолчанию номер зоны и полушарие выбираются автоматически, для каждого файла в отдельности, в зависимости от координат первой трассы файла. Определение номера зоны происходит по следующей формуле:

    zone = int((lon + 180.0) % 360.0 / 6) + 1

где `lon` – долгота из первой трассы XTF файла; `zone` – номер UTM зоны; `int` – функция выбора ближайшего к нулю целого числа.

В отладочном окне перед преобразованием каждого файла выводятся автоматически выбранные параметры UTM:

    [1/6] C:/xtf/24_d.xtf -> 24_d.seg
    Detected UTM zone: 42N

Может возникнуть ситуация, когда автоматическое определение параметров UTM не подходит. Участок может оказаться на стыке зон. Или в первой трассе могут быть записаны некорректные координаты. В таком случае нужно настроить зону и полушарие вручную: *Tools -> Preferences*. В следующем примере для всех последующих экспортов в SEG-Y будет использована зона №39 и северное полушарие (`N`):

![preferences screenshot](prefs_screenshot.png)

Существует 60 зон – от 1 до 60. Зона №1 используется для региона от 180°W до 174°W (осевой меридиан 177°W). Далее номера зон увеличиваются при движении на восток и достигают №60 для региона между 174°E и 180°E (осевой меридиан 177°E). Также смотрите таблицу со списком UTM зон ниже.

*Замечание:* настройка UTM после завершения программы не сохраняется.

### В предыдующей версии программы
В XTF Surveyor **версии 0.4** в SEG-Y файл записывались **географические** координаты. В заголовках трасс:

* Байты 71-72,  коэффициент масштабирования: `-100`. Координаты перед использованием нужно поделить на 100.
* Байты 89-90, единицы измерения для координат: `2`, секунды дуги.

Формула:

    D = S / 60 / 60 / |C|

где `D` – географические координаты (градусы в десятичном формате); `S` – координаты из SEG-Y файла; `|C|` – модуль коэффициента масштабирования.

[1]: http://www.seg.org/documents/10161/77915/seg_y_rev1.pdf

## История версий программы

| Версия | Изменения |
|--------|-----------|
| 0.6.1  | Исправлена ошибка, возникавшая при пакетном преобразовании файлов с различающимися каналами. Программа выдавала внутреннюю ошибку, если в одном из файлов проекта отсутствовал выбранный для преобразовании в SEG-Y канал. Теперь выдаётся ошибка `Aborted! Channel 3 not found inside имя-файла.xtf.`|

## Приложение. Таблица зон UTM.

| № зоны | Регион | Осевой меридиан |
|--------|--------|-----------------|
1 | 180°W – 174°W | 177°W |
2 | 174°W – 168°W | 171°W |
3 | 168°W – 162°W | 165°W |
4 | 162°W – 156°W | 159°W |
5 | 156°W – 150°W | 153°W |
6 | 150°W – 144°W | 147°W |
7 | 144°W – 138°W | 141°W |
8 | 138°W – 132°W | 135°W |
9 | 132°W – 126°W | 129°W |
10 | 126°W – 120°W | 123°W |
11 | 120°W – 114°W | 117°W |
12 | 114°W – 108°W | 111°W |
13 | 108°W – 102°W | 105°W |
14 | 102°W – 96°W | 99°W |
15 | 96°W – 90°W | 93°W |
16 | 90°W – 84°W | 87°W |
17 | 84°W – 78°W | 81°W |
18 | 78°W – 72°W | 75°W |
19 | 72°W – 66°W | 69°W |
20 | 66°W – 60°W | 63°W |
21 | 60°W – 54°W | 57°W |
22 | 54°W – 48°W | 51°W |
23 | 48°W – 42°W | 45°W |
24 | 42°W – 36°W | 39°W |
25 | 36°W – 30°W | 33°W |
26 | 30°W – 24°W | 27°W |
27 | 24°W – 18°W | 21°W |
28 | 18°W – 12°W | 15°W |
29 | 12°W – 6°W | 9°W |
30 | 6°W – 0°E | 3°W |
31 | 0°E – 6°E | 3°E |
32 | 6°E – 12°E | 9°E |
33 | 12°E – 18°E | 15°E |
34 | 18°E – 24°E | 21°E |
35 | 24°E – 30°E | 27°E |
36 | 30°E – 36°E | 33°E |
37 | 36°E – 42°E | 39°E |
38 | 42°E – 48°E | 45°E |
39 | 48°E – 54°E | 51°E |
40 | 54°E – 60°E | 57°E |
41 | 60°E – 66°E | 63°E |
42 | 66°E – 72°E | 69°E |
43 | 72°E – 78°E | 75°E |
44 | 78°E – 84°E | 81°E |
45 | 84°E – 90°E | 87°E |
46 | 90°E – 96°E | 93°E |
47 | 96°E – 102°E | 99°E |
48 | 102°E – 108°E | 105°E |
49 | 108°E – 114°E | 111°E |
50 | 114°E – 120°E | 117°E |
51 | 120°E – 126°E | 123°E |
52 | 126°E – 132°E | 129°E |
53 | 132°E – 138°E | 135°E |
54 | 138°E – 144°E | 141°E |
55 | 144°E – 150°E | 147°E |
56 | 150°E – 156°E | 153°E |
57 | 156°E – 162°E | 159°E |
58 | 162°E – 168°E | 165°E |
59 | 168°E – 174°E | 171°E |
60 | 174°E – 180°E | 177°E |
